## 1. watsonx Assistantとは？

### 対話型AIチャットボット
IBMの公式説明によると、IBM watsonx Assistantは、組織の誰もが簡単に生成AIアシスタントを作成できる次世代の対話型AIソリューションです。

AIというと若干今のご時世、誤解を招く部分もあるのですが、Chat GPTなどの生成AIと異なり、watsonxの内部にAI部分は存在するものの、作業者によって正解を緻密に設計することで、いわゆる生成AIと異なり、「それらしい文章の中に嘘を紛れ込ませるミスを出さない」という点において優れていると私は感じています。

また、IBM watsonx Assistantの管理画面を見て数ヶ月経つと、あれ？ こんな機能あったっけ？ こんな画面だったっけ？
ということが多々見受けられるので、日々改善を続けているサービスだとも感じています。
注:サービス名称もWatson Assistantからwatsonx Assistantに変更されたため、一部ではまだ公式画面上にも「Watson」表記が残っているくらいです。

### チャットボットとは
チャットボットは海外ではChatterbotなどと呼ばれ、「Chat（おしゃべり）」「Bot（ロボットの略）」つまり、自動で人間のようにおしゃべりをしてくれる存在です。
watsonx Assistantは非AI搭載チャットボットと同じ感覚で、作業者の設計したシナリオに基づいて会話を行います。

### AI非搭載チャットボットの特徴

AI非搭載のチャットボットはChatGPTやGrok同様、即時、いつでもレスポンスは可能ではありますが、それらと最も大きく異なる点として、以下の苦手タスクが存在します。

#### 苦手なこと
- **複雑な質問の解決**: 多数の質問を同時にすると、どれか1つのみへの回答をしてしまう
- **メンタルフォロー**: 登録外の言い換えはわからないため、行間を読むことができない

これらの苦手があっても生き残っている理由として、先にあげた「自分でつけない」良さが実はあるのです。
・生成AIに色々教えて、ミスを減らす調教をし、自在に回答を生成をさせるチャットボット
・答えさせる内容は確実に決め、答えられない内容も存在するが、嘘だけは回答しないチャットボット
どちらが良いチャットボットであると言えるのか、それはチャットボットで提供したい内容次第です。
（あるいは、開発すれば、後者で基本的には答えさせておき、答えが見つからない場合に一定の不確実性が紛れ込む前提で生成AIに答えをバトンタッチすることも理論上可能ですが・・・）

私は昔ながらのチャットボットの良さも知ってもらうべく、この記事を執筆することにしました。

## 2. watsonx Assistantでのチャットボット構築手順

### チャットボット（IBMでの名称：Skill）の作成
1. 以下管理画面にログイン（アカウント作成手順は割愛させていただきます）
https://us-south.assistant.watson.cloud.ibm.com/
※こちらは私が誤って作成時にアメリカゾーンにアカウントを作成してしまったためで、日本ゾーンに作った場合は「us-south」の場所が「jp-tok」となります。
2. 黒色のCreate Skillボタンをクリック
2. Dialog skill（3つボタンがある真ん中）にチェック
3. Nextをクリック
4. 以下のフォームに情報を入力
   - Name: 任意の名前（管理画面および、ダウンロードした際に表示されるSkillの名称となります）
   - Description: （特に記入必須ではありません。何か説明を書きたければどうぞ）
   - Language: Japanese
※日本語でチャットボットを設計したい場合、ここでJapaneseを選ばないと（JSON上で書き換える方法はあるのですが）AI認識部分で問題が生じるため、必ずプルダウンからJapaneseをご選択ください。
5. 青色に活性化されたCreate skillボタンをクリック

## 3. 対話の設計

### 最もシンプルなチャットボット
初期状態で左カラムのメニューから「Dialog」をクリックすると、以下の2つのnodeが作成されています。
#### Welcome
- 条件に「welcome（初めてチャットボットを開いた時に自動的に表示される言葉）」が設定されている
#### Anything_else
- 条件に「anything_else（何のテキストが入力されても反応する）」が設定されている
- 物理的な意味においてAnything_elseより上の場所に設置しているnodeで入力語句と見合わない場合、強制的にこのnodeに書かれた内容が表示される
- つまり、このnodeの下にnodeを設置しても、そのnodeは反応することがない

なお、nodeとはチャットボットのシナリオを書き込むカードのようなものであり、基本的には1つのnodeには1つの段落を書き込むことが推奨されます。
このnodeを組み合わせていくことで、チャットボットが完成します。

### nodeの基本設定
nodeには基本的には以下の4点を設定することができます。
1. **Enter node name（名前）**: 後で混乱しないように内容に即した名前をつける
2. **If assistant recognizes（一致条件）**: どんな入力があった場合に呼び出すことができるか
   - 例: `input.text== "こんにちは"`（完全一致）
   - 例: `#挨拶`（全体的な意味合いの一致）
   - 例: `@場所`（部分的な用語の一致）
3. **Assistant responds（文章、画像など）**: チャットボットの回答本体
4. **Then assistant should（次の動作）**: ユーザーに対してどのようにnodeが次に動くか設定する
   - Wait for reply（ユーザーが入力するまで何もしない）
   - Jump to（ユーザーが何もしなくても、勝手に指定先のnodeに飛んで同時に表示させる）

### nodeの追加方法
パターン① nodeより上にある青いボタンの「Add node」を押す
パターン② 既存nodeの縦3点リーグをクリック
 　　　　　「Add node below（下に作る）」
 　　　　　「Add node above（上に作る）」
 　　　　　「Add child node（子の位置に作る）」
　 　　　　のいずれかを選択

### nodeの削除方法
1. 削除したいnodeの縦3点リーグをクリック
2. 「Delete」を選択

## 4. 応答タイプの種類と設定方法

### 文章
1. Assistant respondsの初期設定プルダウンのまま「Text」
   - 入力した見た目のままのテキストメッセージを返すことができる
   - 制限文字数は4096文字

### 選択肢
1. Assistant respondsの初期設定プルダウンから「Option」を選択
2. Titleに質問文を入力（例: あなたの名前は何ですか？）
   - 他の場所から文章を貼り付けると改行が半角スペースに変換されてしまうため、改行を入れたい場合はJSONツールを開いて改行記号を入れる必要がある
   - 制限文字数は512文字
3. List label（見た目のテキスト）とValue（送信されるテキスト）を設定
   - 基本的には、List labelとValueは同じテキストにする方が好ましい（違う文字が選択した選択肢として表示されるとユーザーが混乱するため）
   - 制限文字数は512文字
   - Webページを開く設定にしたい場合はValueに遷移させたいURLを入力する
4. 選択肢を作る場合は、必ず子node（選択肢を選んだ場合に反応するnodeのこと）が必要となる
上記のnodeの追加方法で「Add child node」を選択
5. child node側でそれぞれの選択肢に対する一致条件を設定
   - 条件: `input.text== "田中"` 
   - 条件: `input.text== "佐藤"` 
   - 条件: `input.text== "高橋"` など

### 画像
1. Assistant respondsの初期設定プルダウンから「Image」を選択
2. Title（画像と一緒に出力されるメッセージ、省略可）を入力
3. Image sourceにhttpsから始まる画像URLを指定する

## 5. Entity
単語ベースで部分的に捉える仕組みです。特定の単語や語句を認識して、それに基づいて応答します。

#### 特徴
- **メリット**:
  - 出力の予想が容易
  - 複数の単語の組み合わせで複雑な会話構成も可能
- **デメリット**:
  - 言葉の揺らぎへの柔軟性が低い
  - 特に活用形のある動詞に弱い
  - Dialogの順番によって出力が変化する（上位が優先される）

#### 設定方法
1. My Entitiesを選択
2. Create entityをクリック
3. エンティティに名前をつける（例: @挨拶）
4. Create entityをクリック
5. 値と同義語を登録
   - 例: 「こんにちは」の同義語として「こんにちわ」「今日は」などを登録

#### Dialogでの使用
- 条件に `@エンティティ名` を指定
- 例: `@挨拶` や `@場所:東京`

## 6. Intent（インテント）
全体を意味で捉える仕組みです。ユーザーの発言の意図を理解して応答します。

#### 特徴
- **メリット**:
  - 言葉の揺らぎへの対応が柔軟
  - 語順が異なる場合も対応可能
  - 送り仮名や活用形の揺らぎにも対応
  - Dialogの順番に左右されない
- **デメリット**:
  - 出力保証ができない
  - 複雑に制御する必要のある会話構成には向かない
  - 登録し過ぎると偏りが出る

#### 設定方法
1. Intentsを選択
2. Create intentをクリック
3. インテントに名前をつける（例: #挨拶）
4. Create intentをクリック
5. 例文を複数登録（3〜4例以上が望ましい）
   - 例: 「おはようございます」「こんにちは」「こんばんは」など

#### Dialogでの使用
- 条件に `#インテント名` を指定
- 例: `#挨拶` や `#問い合わせ`

### 使い分け
- **Entityだけを使用**: 予測される用語が明確、質問内容が短い、Q&Aの数が少ない場合
- **Intentだけを使用**: 一般的な用語が中心、FAQ数が少ない、入力内容が複雑・長文の場合
- **EntityとIntentの組み合わせ**: 専門用語や固有名詞が多い、FAQ数が多い場合

## 7. Context
会話の流れに沿って、様々なユーザーデータをチャットボットに記憶させるために使用します。

### Contextでできること
- こちらで設定した選択肢をユーザーが選んだ場合に情報を記憶させる
- 覚えさせた記憶は上書きすることもできる
- 覚えさせた記憶は忘れさせることもできる
- 上記の内容は全てこちらの設定次第で、勝手に忘れたり変わることはない

### Contextの設定方法
1. Open context editorを選択
2. Variable（変数名）とValue（値）を設定
   - 変数名は `$` で始まる（例: `$name`）


### ヒアリングシナリオの構築
1. ユーザーから情報を得る
   - Assistant responds右にある縦3点リーグから、Open context editorを選択
   - Then set contextフォームに以下入力
      - Variable: 変数名（例: `name`）
      - Value: 値（例: `<? input.text ?>``1`）
      - 直接ユーザーが入力した語句をそのまま覚えさせたくない時は、一旦child nodeを挟むなど工夫が必要
2. その変数名に対応するContextに自動保存される
3. 保存した情報を取り出して表示
   - 例：回答内で `<? $name ?>さん、よろしくお願いします`

### 計算式シナリオの構築
これを上手く使うと、チャットボットに計算をさせることも可能です。
1. 回答に点数を与える
2. 合計点を計算
3. 結果に応じて回答を分岐

仮に5点満点で、3点以上合格の問題を設計することにします。
1問目：1点
2問目：2点
3問目：2点（1点の部分点あり）

### 非エンジニアへのTips
- `==` : 一致する
- `!=` : 一致しない
- `>` : より大きい
- `<` : より小さい
- `>=` : 以上
- `<=` : 以下
- `+` `-` `*` `/` : 四則演算

その他詳しい式言語のメソッドは、公式が一番分かりやすく記載しています。
以下、ご参考いただくと良いかと思います。
https://cloud.ibm.com/docs/watson-assistant?topic=watson-assistant-expression-methods-actions&locale=ja

お読みいただきありがとうございました。